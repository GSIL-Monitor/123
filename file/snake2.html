<!doctype html>
<html>
<body>
<canvas id="can" width="900" height="900" style="background: Black"></canvas>
<script>
    var sn = [42, 41], dz = [43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 57, 54, 55,1,2,3,2,131,3,12,124,123,21,3,12,1,23,123,1,41,23,12,4,12,312,3,14,12,3,213], fx = 1, n,
        ctx = document.getElementById("can").getContext("2d");

    function draw(t, c) {
        ctx.fillStyle = c;
        ctx.fillRect(t % 30 * 30 + 1, ~~(t / 30) * 30 + 1, 28, 28);
    }

    document.onkeydown = function (e) {
        fx = sn[1] - sn[0] == (n = [-1, -30, 1, 30][(e || event).keyCode - 37] || fx) ? fx : n;
        console.log("fx:" + fx)
    };
    !function () {
        n = sn[0] + fx;
        console.log("sn:" + sn);
        if (n > 900) {
            n = 0;
        }
        if (n < 0) {
            n = 899;
        }
        sn.unshift(n);
        console.log(n);
        draw(n, "red");
        var eat = false;
        for (var i = 0; i < dz.length; i++) {
            if (n === dz[i]) {
                while (sn.indexOf(dz[i] = ~~(Math.random() * 900)) >= 0) ;
                draw(dz[i], "Yellow");
                eat = true;
            }
        }
        if (!eat) {
            draw(sn.pop(), "Black");
        }
        setTimeout(arguments.callee, 120);
    }();
</script>
</body>
</html>
