<!doctype html>
<html>
<body>
<canvas id="can" width="400" height="400" style="background: Black"></canvas>
<script>
    var sn = [42, 41], dz = 43, fx = 1, n, ctx = document.getElementById("can").getContext("2d");

    function draw(t, c) {
        ctx.fillStyle = c;
        ctx.fillRect(t % 20 * 20 + 1, ~~(t / 20) * 20 + 1, 18, 18);
    }

    document.onkeydown = function (e) {
        fx = sn[1] - sn[0] == (n = [-1, -20, 1, 20][(e || event).keyCode - 37] || fx) ? fx : n;
    };


    
    var openList = [n];
    var closeList = [];

    function getCur() {
        if (openList.length === 0){
            return n;
        }
        return undefined;
    }
    function a() {
        while(openList.length !==0){
            var cur = openList.pop();
            closeList.add(cur);
            var around = getAroundNode(cur);
            out : for (var b in around){

                if (openList.length !== 0) {
                    for (o in openList){
                        if (o.b = b) {
                            continue out;
                        }
                    }
                }


                var d = getDistance(b,dz);
                var node = {
                    F : d,
                    b : b,
                    parent : n
                }
                openList.add(node)
            }

        }
    }


    function getDistance(a, b) {
        // var arr = Array.of();
        var aY = ~~(a / 20);
        var bY = ~~(b / 20);
        var aX = a % 20;
        var bX = a % 20;
        var y = Math.abs(aY - bY);
        var x = Math.abs(aX - bX);
        return x + y;
    }


    function getAroundNode(a) {
        var up = a - 20;
        var left = a - 1;
        var right = a + 1;
        var down = a + 20;
        return [up, left, right, down];

    }

    function isOk(a) {

    }


    function auto() {
        var distance = dz - n;
        var change = 0;
        if (distance < 0) {
            if (distance < -20) {
                change = -20;
            } else {
                if (~~(n / 20) - ~~(dz / 20) !== 0) {
                    change = -20;
                } else
                    change = -1
            }
        } else {
            if (distance > 20) {
                change = 20
            } else {
                if (~~(n / 20) - ~~(dz / 20) !== 0) {
                    change = 20;

                } else
                    change = 1
            }
        }
        // var next = n + change;
        // var a = [1,-1,-20,20];
        // var i = 0;
        // while(sn.indexOf(next,1)>0 || next<0||next>399||fx==1&&next%20==0||fx==-1&&next%20==19){
        //     change = a[i++%4];
        //     next = n + change;
        // }


        if (distance > -20 || distance < 20) {
            console.log("~~(n/20)=" + (~~(n / 20)));
            console.log("~~(dz/20)=" + (~~(dz / 20)));
            console.log("~~(n/20) - ~~(dz/20)=" + (~~(n / 20) - ~~(dz / 20)));
        }
        if (change != fx) {
            console.log(distance);
        }
        return change;
    }


    !function () {
        n = sn[0] + fx;
        if (n > 400) {
            n = 0;
        }
        if (n < 0) {
            n = 399;
        }
        sn.unshift(n);
        draw(n, "red");
        if (n == dz) {
            var count = 0;
            while (sn.indexOf(dz = ~~(Math.random() * 400)) >= 0)
                if (count++ > 10000) {
                    ctx.fillStyle = "black";
                    ctx.fillRect(0, 0, 400, 400);
                    sn = [sn[0], sn[1]];
                    count = 0;
                }
            ;
            draw(dz, "Yellow");
        } else {
            var p = sn.pop();
            if (sn.indexOf(p) < 0)
                draw(p, "Black");
        }
        fx = auto();
        setTimeout(arguments.callee, 100);
    }();
</script>
</body>
</html>
